# Permissions Required
# API [deploymentmanager.googleapis.com]
# Identity and Access Management (IAM) API
# Compute API
# Service Networking API
# Cloud SQL API


imports:
  # Compute Engine VM Resources
  - path: ./../../py_templates/compute_engine/bastion_for_qubole/qubole_bastion.py
    name: qubole_bastion.py
  - path: ./../../py_templates/compute_engine/cloud_sql_proxy_for_metastore/cloud_sql_proxy.py
    name: cloud_sql_proxy.py
  # Compute Engine Addresses
  - path: ./../../py_templates/vpc_network/external_ip_addresses/qubole_bastion_ext_address.py
    name: qubole_bastion_ext_address.py
  - path: ./../../py_templates/vpc_network/external_ip_addresses/cloudsql_int_address_range.py
    name: cloudsql_int_address_range.py
  - path: ./../../py_templates/vpc_network/external_ip_addresses/cloud_sql_proxy_int_address.py
    name: cloud_sql_proxy_int_address.py
  - path: ./../../py_templates/vpc_network/external_ip_addresses/cloud_sql_proxy_ext_address.py
    name: cloud_sql_proxy_ext_address.py
  # Compute Engine Firewall Rules
  - path: ./../../py_templates/vpc_network/firewall_rules/qubole_bastion_ingress.py
    name: qubole_bastion_ingress.py
  - path: ./../../py_templates/vpc_network/firewall_rules/cloud_sql_proxy_ingress.py
    name: cloud_sql_proxy_ingress.py
  # VPC Network Networks
  - path: ./../../py_templates/vpc_network/networks/qubole_dedicated_vpc_network.py
    name: qubole_dedicated_vpc_network.py
  - path: ./../../py_templates/vpc_network/networks/cloud_sql_proxy_vpc_network.py
    name: cloud_sql_proxy_vpc_network.py
  # VPC Network SubNetworks
  - path: ./../../py_templates/vpc_network/networks/private_subnetwork.py
    name: private_subnetwork.py
  - path: ./../../py_templates/vpc_network/networks/public_subnetwork.py
    name: public_subnetwork.py
  - path: ./../../py_templates/vpc_network/networks/cloud_sql_proxy_subnetwork.py
    name: cloud_sql_proxy_subnetwork.py
  # VPC Network Peerings
  - path: ./../../py_templates/vpc_network/peering/peer_cloud_sql_proxy_qubole_vpc.py
    name: peer_cloud_sql_proxy_qubole_vpc.py
  # Cloud SQL Instances
  - path: ./../../py_templates/cloud_sql/metastore/hive_metastore.py
    name: hive_metastore.py

resources:
  # Compute Engine VM Resources
  - name: qubole_bastion
    type: qubole_bastion.py
    properties:
      zone: asia-southeast1-a
      machineType: f1-micro
      public_ssh_key: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCuNs16ilK2zat5dNN6oPqxcD1xYhzZiS1/g7LMYxAO3Bhm712ZR1Uc7LMICLqk8CeI8Ji7g3yqRaHZEkl8YiGS6JAEGOXBMKQdHBQVlyQR8CTiKB4+PxlNQuCjsP/e+mVtS/QwuLno+qTO5HAAcSmgsNNJn4R4zfuRMK7Lo1zv0ZYyxWrRQ/Oo/A8FBEoiNvsPhoG9TBWR4YbLkxWh9hR0TIsCdtMz1TPqBKe7bKg7onHUKIh1vByT8nzzim6F3WBHoeWYnpyuYVcQi2XHWQTVbZ/g/Xi85LsUxfBeggo02pE1WkRufFQ3Aa4ddZJH8b6u5pSIBbt2l7Ay5NZg538v
  - name: cloud_sql_proxy
    type: cloud_sql_proxy.py
    properties:
      region: asia-southeast1
      zone: asia-southeast1-a
      machineType: f1-micro
      org: vg-acc422-28
      serviceAccount: cloud-sql-proxy-service-acc@qubole-on-gcp.iam.gserviceaccount.com
    metadata:
      dependsOn:
          - hive_metastore.py
  # Compute Engine Addresses
  - name: qubole_bastion_ext_ip
    type: qubole_bastion_ext_address.py
    properties:
      region: asia-southeast1
  - name: cloud_sql_proxy_int_address
    type: cloud_sql_proxy_int_address.py
    properties:
      region: asia-southeast1
  - name: cloudsql_int_address_range
    type: cloudsql_int_address_range.py
    properties:
      region: asia-southeast1
  - name: cloud_sql_proxy_ext_address
    type: cloud_sql_proxy_ext_address.py
    properties:
      region: asia-southeast1
  # Compute Engine Firewall Rules
  - name: qubole_bastion_firewall_rules
    type: qubole_bastion_ingress.py
  - name: cloud_sql_proxy_ingress
    type: cloud_sql_proxy_ingress.py
  # VPC Network Networks
  - name: qubole_dedicated_vpc_network
    type: qubole_dedicated_vpc_network.py
  - name: cloud_sql_proxy_vpc_network
    type: cloud_sql_proxy_vpc_network.py
  # VPC Network SubNetworks
  - name: qubole_dedicated_public_subnet
    type: public_subnetwork.py
    properties:
      region: asia-southeast1
  - name: qubole_dedicated_private_subnet
    type: private_subnetwork.py
    properties:
      region: asia-southeast1
  - name: cloud_sql_proxy_subnetwork
    type: cloud_sql_proxy_subnetwork.py
    properties:
      region: asia-southeast1
  # VPC Network Peerings
  - name: peer_cloud_sql_proxy_qubole_vpc
    type: peer_cloud_sql_proxy_qubole_vpc.py
    metadata:
      dependsOn:
        - cloud_sql_proxy_vpc_network.py
        - qubole_dedicated_vpc_network.py
  # Cloud SQL Instances
  - name: hive_metastore
    type: hive_metastore.py
    properties:
      region: asia-southeast1
      zone: asia-southeast1-a
      tier: db-n1-standard-1
      root_password: root_password!23
      hive_user_name: hive_user
      hive_user_password: hive_user_password!23
      hive_schema_file: gs://vihag-public-artifacts/hive-schema-2.1.0-no-txn.mysql.sql
      org: vg-acc422-28
    metadata:
      dependsOn:
        - cloudsql_int_address_range.py


